<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì´ë¯¸ì§€ ë³€í™˜ - ì‹œì‘</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h1>âœ¨ AI ì´ë¯¸ì§€ ë³€í™˜ ì‹œì‘</h1>

    <section id="uploadSection" class="section-box">
        <input type="file" **accept="image/\*"** id="fileUploader">
        <button id="uploadButton" class="btn primary-btn">ğŸ“¸ ì‚¬ì§„/íŒŒì¼ ì—…ë¡œë“œ</button>
        <img id="originalImage" alt="ì—…ë¡œë“œëœ ì›ë³¸ ì´ë¯¸ì§€" style="display: none;">
    </section>

    <section id="aiProcessingArea" class="section-box" style="display: none;">
        <h3>AI ë³€í™˜ ìŠ¤íƒ€ì¼ ì„¤ì •</h3>

        <textarea id="promptInput" placeholder="ì›í•˜ëŠ” ìŠ¤íƒ€ì¼ì´ë‚˜ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."
                  rows="3" class="input-full"></textarea>

        <select id="styleSelect" class="input-full">
            <option value="default">ìŠ¤íƒ€ì¼ ì„ íƒ (ì„ íƒ ì‚¬í•­)</option>
            <option value="cartoon">ì¹´íˆ° ìŠ¤íƒ€ì¼</option>
            <option value="oilpainting">ìœ í™” ìŠ¤íƒ€ì¼</option>
        </select>

        <button id="aiConvertButton" class="btn secondary-btn">âœ¨ AIë¡œ ë³€í™˜í•˜ê¸°</button>

        <p id="loadingStatus" class="status-text" style="display: none;">AI ì´ë¯¸ì§€ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
    </section>
</div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        // ... (ìš”ì†Œ ë³€ìˆ˜ ì„ ì–¸ ìƒëµ)
        const fileUploader = document.getElementById('fileUploader');
        const uploadButton = document.getElementById('uploadButton');
        const originalImage = document.getElementById('originalImage');
        const aiProcessingArea = document.getElementById('aiProcessingArea');
        const aiConvertButton = document.getElementById('aiConvertButton');
        const loadingStatus = document.getElementById('loadingStatus');

        let uploadedFile = null;

        // íŒŒì¼ ì„ íƒ ì°½ ì—´ê¸°
        uploadButton.addEventListener('click', () => { fileUploader.click(); });

        // íŒŒì¼ì´ ì„ íƒë˜ì—ˆì„ ë•Œ
        fileUploader.addEventListener('change', (event) => {
            uploadedFile = event.target.files[0];
            if (!uploadedFile) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                originalImage.src = e.target.result;
                originalImage.style.display = 'block';
                aiProcessingArea.style.display = 'block';
            };
            reader.readAsDataURL(uploadedFile);
        });

        // AI ë³€í™˜ ë²„íŠ¼ í´ë¦­ ì‹œ
        aiConvertButton.addEventListener('click', async () => {
            const prompt = document.getElementById('promptInput').value;
            const style = document.getElementById('styleSelect').value;

            if (!uploadedFile) return alert('ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
            if (!prompt) return alert('í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            loadingStatus.style.display = 'block';
            aiConvertButton.disabled = true;

            // ë°±ì—”ë“œ API í˜¸ì¶œì„ ìœ„í•œ FormData ìƒì„±
            const formData = new FormData();
            formData.append('image', uploadedFile);
            formData.append('prompt', prompt);
            formData.append('style', style);

            try {
                const response = await fetch('/api/ai-process', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`AI ì„œë²„ ì˜¤ë¥˜: ${response.statusText}`);
                }

                const data = await response.json();
                const aiImageUrl = data.aiImageUrl;

                if (aiImageUrl) {
                    // **download.htmlë¡œ ì´ë™ ë° ê²°ê³¼ URL ì „ë‹¬**
                    window.location.href = `download.html?url=${encodeURIComponent(aiImageUrl)}`;
                } else {
                    alert('AI ë³€í™˜ ê²°ê³¼ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                alert('ì´ë¯¸ì§€ ë³€í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                console.error('Fetch Error:', error);
            } finally {
                loadingStatus.style.display = 'none';
                aiConvertButton.disabled = false;
            }
        });
    });
</script>
</body>
</html>