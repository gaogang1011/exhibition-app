<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ì‹œíšŒ AI ì´ë¯¸ì§€ ë³€í™˜ ë””ìŠ¤í”Œë ˆì´</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h1>AI ìŠ¤íƒ€ì¼ ë³€í™˜ ë¶€ìŠ¤ âœ¨</h1>
    <div id="status">ì„¸ì…˜ì„ ìƒì„±í•˜ëŠ” ì¤‘...</div>

    <div id="qrCodeDisplay" style="display:none;">
        <p>ëª¨ë°”ì¼ë¡œ ì•„ë˜ QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”!</p>
        <div id="qrcode"></div>
    </div>

    <div id="imageDisplay" style="display:none;">
        <div class="image-box">
            <p>ì›ë³¸ ì´ë¯¸ì§€:</p>
            <img id="originalImage" src="" alt="ì—…ë¡œë“œëœ ì›ë³¸ ì´ë¯¸ì§€" class="image-preview">
        </div>

        <div class="image-box">
            <p>AI ë³€í™˜ ì´ë¯¸ì§€:</p>
            <img id="transformedImage" src="" alt="AI ë³€í™˜ ì´ë¯¸ì§€" class="image-preview">
        </div>

        <div id="downloadQrCode" class="download-qr-code">
            <p>ë³€í™˜ëœ ì´ë¯¸ì§€ë¥¼ **ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ ì•„ë˜ QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì„¸ìš”! ğŸ‘‡</p>
            <div id="downloadQrcodeElement"></div>
        </div>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script>
    const socket = io({
        transports: ['websocket'], // ì›¹ì†Œì¼“ ì—°ê²°ë§Œ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œ
        upgrade: false             // ì—°ê²° ì—…ê·¸ë ˆì´ë“œ ì‹œë„í•˜ì§€ ì•Šë„ë¡ ì„¤ì •
    });
    let qrcode = new QRCode(document.getElementById("qrcode"), { width: 200, height: 200 });
    let downloadQrcode = new QRCode(document.getElementById("downloadQrcodeElement"), { width: 150, height: 150 });

    socket.emit('createSession'); // ì„œë²„ì— ì„¸ì…˜ ìƒì„± ìš”ì²­

    socket.on('sessionCreated', (data) => {
        const uploadUrl = window.location.origin + data.uploadUrl;
        qrcode.makeCode(uploadUrl);
        document.getElementById('status').innerText = 'ì—…ë¡œë“œ ëŒ€ê¸° ì¤‘';
        document.getElementById('qrCodeDisplay').style.display = 'block';
    });

    // ëª¨ë°”ì¼ ì—…ë¡œë“œ ì™„ë£Œ ì‹œ (ì‹¤ì‹œê°„)
    socket.on('imageUploaded', (data) => {
        document.getElementById('qrCodeDisplay').style.display = 'none';
        document.getElementById('imageDisplay').style.display = 'flex'; // ì´ë¯¸ì§€ ì˜ì—­ í‘œì‹œ
        document.getElementById('originalImage').src = data.imageUrl;
        document.getElementById('status').innerText = 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ! AI ë³€í™˜ ì¤‘...';

        // ê¸°ì¡´ ì´ë¯¸ì§€ ì´ˆê¸°í™”
        document.getElementById('transformedImage').src = '';
        document.getElementById('downloadQrCode').style.display = 'none';
    });

    // AI ë³€í™˜ ì™„ë£Œ ì‹œ (ì‹¤ì‹œê°„)
    socket.on('imageTransformed', (data) => {
        document.getElementById('transformedImage').src = data.transformedImageUrl;
        document.getElementById('status').innerText = 'AI ë³€í™˜ ì™„ë£Œ!';

        // ë‹¤ìš´ë¡œë“œ QR ì½”ë“œ ìƒì„± (ë‹¤ìš´ë¡œë“œ URLì„ QR ì½”ë“œë¡œ ì¸ì½”ë”©)
        downloadQrcode.makeCode(window.location.origin + data.transformedImageUrl);
        document.getElementById('downloadQrCode').style.display = 'block';
    });
</script>
</body>
</html>